(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{834:function(e,t,n){"use strict";n.r(t);var l=n(41),r=(n(60),n(85),{data:function(){return{clients:{result:[],total:0},client:null,models:[{id:"prj",label:"Проекты",fieldsTable:["_id","title"]},{id:"bld",label:"Здания",fieldsTable:["_id","title"]},{id:"sct",label:"Секции",fieldsTable:["_id","title"]},{id:"flr",label:"Типовые Этажи",fieldsTable:["_id","sct","floorNumbers"]},{id:"flt",label:"Планировки",fieldsTable:["_id","title","sct"]},{id:"prd",label:"Помещения",fieldsTable:["_id","title"]}],model:null,items:{result:[],total:0},item:null,page:{number:1,size:24},actions:[{id:"createCSV",label:"Создать из CSV"}],action:null,csvFile:null}},mounted:function(){this.getClients()},methods:{getClients:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n={skip:0,limit:999999},t.next=4,e.$axios.$get("/api/adm/getClients/"+JSON.stringify(n));case 4:e.clients=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},setClient:function(e){this.client=e},setModel:function(e){this.model=e,this.page.number=1,this.getItems()},getItems:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n={skip:e.page.number*e.page.size-e.page.size,limit:e.page.size,client:e.client.alias,model:e.model.id},t.next=4,e.$axios.$get("/api/adm/get/"+JSON.stringify(n));case 4:e.items=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},updateOpen:function(){},actionOpen:function(e){this.action=e,this.$bvModal.show("modalCreate")},actionStart:function(e){"createCSV"===e&&this.createCSV()},parseCSV:function(e){var t=this;return new Promise((function(n,l){t.$papa.parse(e,{header:!0,complete:function(e,t){n(e.data)},error:function(e,t){l(e)}})}))},createCSV:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.parseCSV(e.csvFile);case 3:return n=t.sent,l={client:e.client.alias,model:e.model.id,items:n},t.next=7,e.$axios.$post("/api/adm/createMultiple",{params:JSON.stringify(l)});case 7:e.$bvModal.hide("modalCreate"),e.csvFile=null,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.log(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))()}}}),o=n(204),component=Object(o.a)(r,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex flex-column w-100 h-100 flex-grow-1 overflowxy"},[t("div",{staticClass:"d-flex flex-row justify-content-between align-items-center p-3 border-bottom"},[t("div",{staticClass:"d-flex flex-row align-items-center"},[t("b-dropdown",{staticClass:"mr-3",attrs:{id:"ddClient",text:"Выбрать клиента"}},e._l(e.clients.result,(function(n){return t("b-dropdown-item",{key:n._id,on:{click:function(t){return e.setClient(n)}}},[e._v("\n                    "+e._s(n.title)+"\n                ")])})),1),e._v(" "),null!==e.client?t("b-dropdown",{attrs:{id:"ddModel",text:"Выбрать модель"}},e._l(e.models,(function(n){return t("b-dropdown-item",{key:n.id,on:{click:function(t){return e.setModel(n)}}},[e._v("\n                    "+e._s(n.label)+"\n                ")])})),1):e._e()],1),e._v(" "),t("div",{staticClass:"d-flex flex-row align-items-center"},[null!==e.model?t("b-dropdown",{attrs:{id:"ddAction",text:"Действия",right:""}},e._l(e.actions,(function(n){return t("b-dropdown-item",{key:n.id,on:{click:function(t){return e.actionOpen(n)}}},[e._v("\n                    "+e._s(n.label)+"\n                ")])})),1):e._e()],1)]),e._v(" "),t("div",{staticClass:"d-flex flex-fill"},[null!==e.client&&null!==e.model?t("b-table",{key:"table"+e.page.number,attrs:{striped:"",hover:"",responsive:"","sticky-header":"100%",items:e.items.result,fields:e.model.fieldsTable},scopedSlots:e._u([{key:"cell(_id)",fn:function(data){return[t("div",{staticClass:"d-flex flex-row"},[t("Button",{staticClass:"cursor-pointer mr-3 text-underline",attrs:{icon:{type:"element",src:"el-icon-s-tools"},label:"Редактировать"},on:{click:function(t){return e.updateOpen(data.value)}}}),e._v("\n\n                    "+e._s(data.value)+"\n\n                ")],1)]}}],null,!1,396956999)}):e._e()],1),e._v(" "),t("div",{staticClass:"d-flex flex-row p-3 border-top"},[t("b-pagination",{staticClass:"my-0",attrs:{value:e.page.number,"total-rows":e.items.total,"per-page":e.page.size,"first-number":""}})],1),e._v(" "),t("b-modal",{attrs:{id:"modalCreate",title:"Действия",centered:""},on:{ok:function(t){return e.actionStart(e.action.id)}}},[null!==e.action?t("div",{staticClass:"d-flex flex-column"},[t("span",{staticClass:"h3 mb-5"},[e._v(e._s(e.action.label))]),e._v(" "),t("b-form-file",{attrs:{placeholder:"Choose a file or drop it here...","drop-placeholder":"Drop file here..."},model:{value:e.csvFile,callback:function(t){e.csvFile=t},expression:"csvFile"}})],1):e._e()])],1)}),[],!1,null,null,null);t.default=component.exports}}]);